name: Deploy on EC2 self-hosted runner

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  deploy:
    runs-on: self-hosted

    steps:
      # ðŸ‘‰ Pull latest code from GitHub
      - name: Pull latest code from GitHub
        working-directory: /home/ubuntu/www/ChatApp
        run: |
          git reset --hard
          git clean -fd
          git pull origin main

      # ðŸ‘‰ Install Frontend Dependencies
      - name: Install Frontend Dependencies
        working-directory: /home/ubuntu/www/ChatApp/frontend
        run: pnpm install

      # ðŸ‘‰ Build Frontend
      - name: Build Frontend
        working-directory: /home/ubuntu/www/ChatApp/frontend
        run: pnpm run build

      # ðŸ‘‰ Install Backend Dependencies
      - name: Install Backend Dependencies
        working-directory: /home/ubuntu/www/ChatApp/backend
        run: pnpm install

      # ðŸ‘‰ Build Backend (náº¿u cÃ³ build script)
      - name: Build Backend
        working-directory: /home/ubuntu/www/ChatApp/backend
        run: pnpm run build

      # ðŸ‘‰ Reload PM2
      - name: Reload PM2
        run: |
          pm2 reload frontend
          pm2 reload backend
